// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  nombre    String
  apellido  String
  telefono  String
  documento Int
  email     String    @unique
  password  String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  negocios  Negocio[]
  role      Role?     @relation(fields: [roleId], references: [id]) // Relación con el modelo Role
  roleId    Int? // Campo para almacenar el ID del rol
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[]
}

model Negocio {
  id_negocio          Int                  @id @default(autoincrement())
  nombre_negocio      String
  direccion_negocio   String
  fecha_creacion      DateTime             @default(now())
  userId              Int
  usuario             User                 @relation(fields: [userId], references: [id])
  distribuidores      Distribuidor[]       @relation("DistribuidoresNegocios")
  movimientos_entrada Movimiento_Entrada[]
  movimientos_salida  Movimiento_Salida[]
}

model Distribuidor {
  id_distribuidor        Int                   @id @default(autoincrement())
  nombre_distribuidor    String
  apellido_distribuidor  String
  telefono_distribuidor  String
  documento_distribuidor Int
  fecha_creacion         DateTime              @default(now())
  negocios               Negocio[]             @relation("DistribuidoresNegocios")
  granjas_distribuidor   Granja_Distribuidor[]
  movimientos_salida     Movimiento_Salida[]
}

// Modelo de "Granja_Distribuidor" (tabla de relación entre Distribuidor y Granja)
model Granja_Distribuidor {
  id_granja_distri   Int                  @id @default(autoincrement())
  distribuidor       Distribuidor         @relation(fields: [id_distribuidor1], references: [id_distribuidor])
  granja             Granja               @relation(fields: [id_granja1], references: [id_granja])
  fecha_entrada      DateTime             @default(now())
  Movimiento_Entrada Movimiento_Entrada[]
  id_distribuidor1   Int
  id_granja1         Int
}

// Modelo de "Movimiento_Entrada"
model Movimiento_Entrada {
  id_mov_entra        Int                 @id @default(autoincrement())
  id_negocio1         Int
  id_granja_distri1   Int
  peso                Int
  precio_entrada      Int
  fecha_creacion      DateTime            @default(now())
  negocio             Negocio             @relation(fields: [id_negocio1], references: [id_negocio])
  granja_distribuidor Granja_Distribuidor @relation(fields: [id_granja_distri1], references: [id_granja_distri])
  Corte               Corte?              @relation(fields: [id_corte], references: [id_corte])
  id_corte            Int?
}

model Corte {
  id_corte         Int                  @id @default(autoincrement())
  id_raza          Int
  id_categoria     Int
  presentacion     String
  descripcion      String
  fecha_creacion   DateTime             @default(now())
  categoria_animal Animal               @relation(fields: [id_categoria], references: [id_categoria])
  movimientos      Movimiento_Entrada[]
}

// Modelo de "Movimiento_Salida"
model Movimiento_Salida {
  id_salida       Int          @id @default(autoincrement())
  id_negocio      Int
  id_distribuidor Int
  id_corte        Int
  peso            Int
  precio_salida   Int
  fecha_salida    DateTime     @default(now())
  id_raza         Int
  negocio         Negocio      @relation(fields: [id_negocio], references: [id_negocio])
  distribuidor    Distribuidor @relation(fields: [id_distribuidor], references: [id_distribuidor])
  raza            Razas        @relation(fields: [id_raza], references: [id_raza])
}

// Modelo de "Corte"

// Modelo de "Razas"
model Granja {
  id_granja            Int                   @id @default(autoincrement())
  nombre_granja        String
  direccion            String
  fecha_creacion       DateTime              @default(now())
  animales             Animal[] // Relación muchos a muchos con Categoria_Animal
  granjas_distribuidor Granja_Distribuidor[]
}

model Razas {
  id_raza            Int                 @id @default(autoincrement())
  id_categoria       Int
  nombre_raza        String
  categoria          Animal              @relation(fields: [id_categoria], references: [id_categoria])
  movimientos_salida Movimiento_Salida[]
}

model Animal {
  id_categoria     Int      @id @default(autoincrement())
  nombre_categoria String
  razas            Razas[]
  tipos_corte      Corte[]
  granjas          Granja[]
}
